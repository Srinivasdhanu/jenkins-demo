- hosts: web
  become: yes
  user: test
  gather_facts: False
  tasks:
  - name: Download the Docker installer
    get_url:
      url: https://get.docker.com/
      dest: /root/install_docker.sh
      mode: 0700
    when: docker_check.stderr.find('service could not be found') != -1

  - name: Install Docker
    shell: /root/install_docker.sh
    when: docker_check.stderr.find('service could not be found') != -1

  - name: Remove the Docker installer file.
    file:
      state: absent
      path: /root/install_docker.sh

  - name: Enable the Docker daemon in systemd
    systemd:
      name: docker
      enabled: yes
      masked: no

  - name: Start the Docker daemon
    systemd:
      name: docker
      state: started
      masked: no


  - name: Build image and with buildargs
    docker_image:
       path: srinivaskollipaka/myapp
       name: myapp
       buildargs:
         log_volume: /var/log/myapp
         listen_port: 5000

  - name: Tag and push to docker hub
    docker_image:
      name: myapp
      repository: srinivaskollipaka/myapp
      tag: 1.0
      push: yes
